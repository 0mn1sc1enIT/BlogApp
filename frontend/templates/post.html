{% extends 'layout.html' %}

{% block content %}
<div class="row tm-row">
    <div class="col-lg-8 tm-post-col">
        <div class="tm-post-full">                    
            <div class="mb-4">
                {% if post.image %}
                    <div class="tm-mb-40">
                        <img src="data:image/jpeg;base64,{{ post.image }}" class="img-fluid" style="width: 100%;" alt="Post Image">
                    </div>
                {% endif %}

                <h2 class="pt-2 tm-color-primary tm-post-title">{{ post.title }}</h2>
                <p class="tm-mb-40">{{ post.created_at[:10] }} posted by {{ post.author }}</p>
                
                <p>{{ post.content }}</p>

                {% if session.get('user') and session.get('user').id == post.user_id %}
                <form action="{{ url_for('delete_post', post_id=post.id) }}" method="POST" style="display:inline;">
                    <button class="btn btn-danger btn-sm" onclick="return confirm('Are you sure?')">Delete Post</button>
                </form>
                {% endif %}
            </div>

            <div>
                <h2 class="tm-color-primary tm-post-title">Comments</h2>
                <hr class="tm-hr-primary tm-mb-45">
                
                {% for comment in post.comments %}
                <div class="tm-comment tm-mb-45">
                    <div>
                        <p>{{ comment.content }}</p>
                        <div class="d-flex justify-content-between">
                            <span class="tm-color-primary">{{ comment.author }} </span>
                            <span class="tm-color-primary">{{ comment.created_at[:10] }}</span>
                        </div>                                                 
                    </div>                                
                </div>
                {% endfor %}

                {% if session.get('jwt_token') %}
                <form action="{{ url_for('add_comment', post_id=post.id) }}" method="POST" class="mb-5 tm-comment-form">
                    <h2 class="tm-color-primary tm-post-title mb-4">Leave a comment</h2>
                    <div class="mb-4">
                        <textarea class="form-control" name="message" rows="4" required></textarea>
                    </div>
                    <div class="text-right">
                        <button class="tm-btn tm-btn-primary tm-btn-small">Submit</button>                        
                    </div>                                
                </form> 
                {% else %}
                    <p><a href="{{ url_for('login') }}">Log in</a> to leave a comment.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}